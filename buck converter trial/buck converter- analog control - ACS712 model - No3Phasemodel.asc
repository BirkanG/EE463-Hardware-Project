Version 4
SHEET 1 3984 1324
WIRE 2320 -240 2320 -288
WIRE 1456 -128 1072 -128
WIRE 2224 -128 2208 -128
WIRE 2320 -128 2320 -160
WIRE 2320 -128 2304 -128
WIRE 2432 -128 2320 -128
WIRE 2480 -128 2432 -128
WIRE 2496 -128 2480 -128
WIRE 2320 -112 2320 -128
WIRE 2208 -96 2208 -128
WIRE 2432 -96 2432 -128
WIRE 2480 -96 2480 -128
WIRE 368 -80 48 -80
WIRE 512 -80 368 -80
WIRE 608 -80 592 -80
WIRE 736 -80 688 -80
WIRE 928 -80 736 -80
WIRE 1552 -64 1552 -96
WIRE 1552 -64 1120 -64
WIRE 1856 -64 1552 -64
WIRE 2000 -48 2000 -144
WIRE 2000 -48 1920 -48
WIRE 2016 -48 2000 -48
WIRE 2144 -48 2096 -48
WIRE 1856 -32 1808 -32
WIRE 928 -16 928 -80
WIRE 368 0 368 -80
WIRE 1120 0 1120 -64
WIRE 1888 0 1888 -16
WIRE 2208 32 2208 0
WIRE 2320 32 2320 -48
WIRE 2432 32 2432 -32
WIRE 2480 32 2480 -16
WIRE 1808 96 1808 -32
WIRE 1888 96 1808 96
WIRE 736 112 736 -80
WIRE 1120 112 1120 80
WIRE 1808 128 1808 96
WIRE 3680 128 3680 112
WIRE 3344 144 3232 144
WIRE 3472 144 3472 80
WIRE 3472 144 3424 144
WIRE 3648 144 3472 144
WIRE 928 160 928 64
WIRE 3824 160 3712 160
WIRE 1072 176 1072 -128
WIRE 1456 176 1456 -128
WIRE 1456 176 1072 176
WIRE 3648 176 3600 176
WIRE 48 192 48 -80
WIRE 3232 192 3232 144
WIRE 3472 192 3472 144
WIRE 3680 208 3680 192
WIRE 1808 224 1808 208
WIRE 3232 288 3232 272
WIRE 3472 288 3472 256
WIRE 3472 288 3232 288
WIRE 3232 304 3232 288
WIRE 3600 320 3600 176
WIRE 3616 320 3600 320
WIRE 368 352 368 64
WIRE 736 352 736 176
WIRE 736 352 368 352
WIRE 928 352 928 240
WIRE 928 352 736 352
WIRE 368 368 368 352
WIRE 320 448 304 448
WIRE 48 496 48 272
WIRE 48 496 16 496
WIRE 368 496 368 464
WIRE 368 496 48 496
WIRE 48 608 48 496
WIRE 1264 640 1264 624
WIRE 1264 752 1264 720
FLAG 1264 752 0
FLAG 1264 624 5V
FLAG 3232 304 0
FLAG 3680 208 0
FLAG 3680 112 5V
FLAG 48 608 0
FLAG 1888 -80 0
FLAG 1888 0 5V
FLAG 1808 224 0
FLAG 2208 32 0
FLAG 2320 32 0
FLAG 2320 -288 5V
FLAG 2000 -144 decrease_duty
FLAG 2496 -128 duty_reference
FLAG 3616 320 duty_reference
FLAG 3824 160 pwm_signal
FLAG 304 448 pwm_signal
FLAG 1888 96 current_limit_reference
FLAG 3472 80 triangle_wave
FLAG 1120 112 0
FLAG 1552 -96 ACS712_VOUT
FLAG 2432 32 0
FLAG 2480 32 0
SYMBOL nmos 320 368 R0
SYMATTR InstName M1
SYMATTR Value IRFZ46N
SYMBOL diode 384 64 R180
WINDOW 0 24 64 Left 2
WINDOW 3 24 0 Left 2
SYMATTR InstName D1
SYMBOL ind 496 -64 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 5 56 VBottom 2
SYMATTR InstName L1
SYMATTR Value 10µH
SYMBOL voltage 928 144 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V3
SYMATTR Value 12
SYMBOL res 912 -32 R0
SYMATTR InstName R1
SYMATTR Value 0.1
SYMBOL res 704 -96 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R4
SYMATTR Value 0.1
SYMBOL voltage 1264 624 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V13
SYMATTR Value 10V
SYMBOL voltage 3232 176 R0
WINDOW 3 -48 -83 VRight 2
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR Value PULSE(0 5 0 0 0 6.66us 13.33us)
SYMATTR InstName V1
SYMBOL res 3440 128 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R2
SYMATTR Value 660
SYMBOL cap 3456 192 R0
SYMATTR InstName C1
SYMATTR Value 10nF
SYMBOL OpAmps\\AD824 3680 96 R0
SYMATTR InstName U1
SYMBOL OpAmps\\AD824 1888 16 M180
SYMATTR InstName U3
SYMBOL voltage 1808 112 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V6
SYMATTR Value 3.3
SYMBOL npn 2144 -96 R0
SYMATTR InstName Q1
SYMBOL cap 2304 -112 R0
SYMATTR InstName C3
SYMATTR Value 10µF
SYMBOL res 2304 -256 R0
SYMATTR InstName R9
SYMATTR Value 8.6k
SYMBOL res 2112 -64 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R8
SYMATTR Value 300k
SYMBOL cap 720 112 R0
SYMATTR InstName C4
SYMATTR Value 2200µF
SYMBOL bv 1120 -16 R0
WINDOW 3 252 97 Right 2
SYMATTR Value V=2.5+0.083*I(R1)
SYMATTR InstName B1
SYMBOL voltage 48 176 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V4
SYMATTR Value PWL(0 12 25ms 35)
SYMBOL res 2320 -144 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R3
SYMATTR Value 2.3k
SYMBOL zener 2448 -32 R180
WINDOW 0 24 64 Left 2
WINDOW 3 24 0 Left 2
SYMATTR InstName D2
SYMATTR Value 1N750
SYMBOL res 2464 -112 R0
SYMATTR InstName R5
SYMATTR Value 8.6k
TEXT 3208 352 Left 2 ;75kHz square wave
TEXT 1088 -112 Left 2 ;ACS712 MODEL
TEXT 1168 -48 Left 1 ;You may add low pass filter since\n this sensor has a bandwith of 50kHz
TEXT 14 776 Left 2 !.tran 25ms
