Version 4
SHEET 1 4176 1324
WIRE 1872 -624 1856 -624
WIRE 2384 -624 2352 -624
WIRE 2064 -608 1584 -608
WIRE 2576 -608 2096 -608
WIRE 1744 -544 1712 -544
WIRE 1856 -544 1856 -624
WIRE 1856 -544 1824 -544
WIRE 1872 -544 1856 -544
WIRE 1984 -544 1952 -544
WIRE 2256 -544 2224 -544
WIRE 2352 -544 2352 -624
WIRE 2352 -544 2336 -544
WIRE 2384 -544 2352 -544
WIRE 2496 -544 2464 -544
WIRE 1472 -528 1472 -544
WIRE 1712 -480 1712 -544
WIRE 1840 -480 1712 -480
WIRE 1984 -480 1984 -544
WIRE 1984 -480 1904 -480
WIRE 2032 -480 1984 -480
WIRE 2224 -480 2224 -544
WIRE 2352 -480 2224 -480
WIRE 2496 -480 2496 -544
WIRE 2496 -480 2416 -480
WIRE 2544 -480 2496 -480
WIRE 1472 -416 1472 -448
WIRE 1632 -384 1632 -480
WIRE 1712 -384 1712 -480
WIRE 1808 -384 1712 -384
WIRE 1984 -384 1984 -480
WIRE 1984 -384 1872 -384
WIRE 2144 -384 2144 -480
WIRE 2224 -384 2224 -480
WIRE 2320 -384 2224 -384
WIRE 2496 -384 2496 -480
WIRE 2496 -384 2384 -384
WIRE 1584 -304 1584 -608
WIRE 2064 -304 2064 -608
WIRE 2064 -304 1584 -304
WIRE 2096 -304 2096 -608
WIRE 2576 -304 2576 -608
WIRE 2576 -304 2096 -304
WIRE 368 -80 48 -80
WIRE 512 -80 368 -80
WIRE 608 -80 592 -80
WIRE 736 -80 688 -80
WIRE 928 -80 736 -80
WIRE 1488 -64 1104 -64
WIRE 1632 -32 1616 -32
WIRE 2176 -32 2160 -32
WIRE 2480 -32 2480 -80
WIRE 3664 -32 3664 -48
WIRE 928 -16 928 -80
WIRE 3328 -16 3216 -16
WIRE 3456 -16 3456 -80
WIRE 3456 -16 3408 -16
WIRE 3632 -16 3456 -16
WIRE 368 0 368 -80
WIRE 1616 0 1616 -32
WIRE 1616 0 1152 0
WIRE 1728 0 1616 0
WIRE 1824 0 1728 0
WIRE 1840 0 1824 0
WIRE 3808 0 3696 0
WIRE 2160 16 2160 -32
WIRE 2160 16 1888 16
WIRE 2320 16 2160 16
WIRE 2416 16 2400 16
WIRE 3632 16 3584 16
WIRE 1824 32 1760 32
WIRE 3216 32 3216 -16
WIRE 3456 32 3456 -16
WIRE 3664 48 3664 32
WIRE 1152 64 1152 0
WIRE 1856 64 1856 48
WIRE 2176 96 2160 96
WIRE 2272 96 2256 96
WIRE 2480 96 2480 64
WIRE 2736 96 2736 64
WIRE 736 112 736 -80
WIRE 3216 128 3216 112
WIRE 3456 128 3456 96
WIRE 3456 128 3216 128
WIRE 1760 144 1760 32
WIRE 2160 144 2160 96
WIRE 2160 144 1760 144
WIRE 3216 144 3216 128
WIRE 928 160 928 64
WIRE 3584 160 3584 16
WIRE 3600 160 3584 160
WIRE 1152 176 1152 144
WIRE 48 192 48 -80
WIRE 1104 224 1104 -64
WIRE 1488 224 1488 -64
WIRE 1488 224 1104 224
WIRE 2160 224 2160 144
WIRE 2480 224 2480 176
WIRE 2624 224 2480 224
WIRE 2736 224 2736 176
WIRE 2736 224 2624 224
WIRE 2752 224 2736 224
WIRE 1824 256 1712 256
WIRE 2480 256 2480 224
WIRE 2736 256 2736 224
WIRE 1984 272 1888 272
WIRE 2096 272 2064 272
WIRE 2624 272 2624 224
WIRE 1728 288 1728 0
WIRE 1824 288 1728 288
WIRE 368 352 368 64
WIRE 736 352 736 176
WIRE 736 352 368 352
WIRE 928 352 928 240
WIRE 928 352 736 352
WIRE 2160 352 2160 320
WIRE 368 368 368 352
WIRE 2624 384 2624 336
WIRE 2736 384 2736 336
WIRE 2480 400 2480 336
WIRE 1728 432 1728 288
WIRE 1824 432 1728 432
WIRE 320 448 304 448
WIRE 2176 448 1888 448
WIRE 2320 448 2176 448
WIRE 2416 448 2400 448
WIRE 1824 464 1712 464
WIRE 48 496 48 272
WIRE 48 496 16 496
WIRE 368 496 368 464
WIRE 368 496 48 496
WIRE 2176 496 2176 448
WIRE 2192 496 2176 496
WIRE 2480 528 2480 496
WIRE 48 608 48 496
FLAG 1472 -416 0
FLAG 1472 -544 10V
FLAG 3216 144 0
FLAG 3664 48 0
FLAG 3664 -48 10V
FLAG 48 608 0
FLAG 1856 -16 0
FLAG 1856 64 10V
FLAG 2624 384 0
FLAG 2480 -80 10V
FLAG 2160 -32 ~INCREASE_PWM_REF
FLAG 2752 224 duty_reference
FLAG 3600 160 duty_reference
FLAG 3808 0 pwm_signal
FLAG 304 448 pwm_signal
FLAG 3456 -80 triangle_wave
FLAG 1152 176 0
FLAG 1616 -32 ACS712_VOUT
FLAG 2736 384 0
FLAG 2144 -384 10V
FLAG 2544 -480 0
FLAG 2352 -624 CURRENT_REF
FLAG 2736 64 10V
FLAG 1856 304 10V
FLAG 1856 240 0
FLAG 1632 -384 10V
FLAG 2032 -480 0
FLAG 2160 352 0
FLAG 1856 -624 MIN_CURRENT_REF
FLAG 2272 96 CURRENT_REF
FLAG 1712 256 MIN_CURRENT_REF
FLAG 2480 528 0
FLAG 1712 464 CURRENT_REF
FLAG 1856 480 10V
FLAG 1856 416 0
FLAG 2176 496 DECREASE_PWM
SYMBOL nmos 320 368 R0
SYMATTR InstName M1
SYMATTR Value IRFZ46N
SYMBOL diode 384 64 R180
WINDOW 0 24 64 Left 2
WINDOW 3 24 0 Left 2
SYMATTR InstName D1
SYMBOL ind 496 -64 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 5 56 VBottom 2
SYMATTR InstName L1
SYMATTR Value 10µH
SYMBOL voltage 928 144 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V3
SYMATTR Value 12
SYMBOL res 912 -32 R0
SYMATTR InstName R1
SYMATTR Value 0.1
SYMBOL res 704 -96 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R4
SYMATTR Value 0.1
SYMBOL voltage 1472 -544 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V13
SYMATTR Value 10V
SYMBOL voltage 3216 16 R0
WINDOW 3 -48 -83 VRight 2
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR Value PULSE(0 10 0 0 0 6.66us 13.33us)
SYMATTR InstName V1
SYMBOL res 3424 -32 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R2
SYMATTR Value 1.5k
SYMBOL cap 3440 32 R0
SYMATTR InstName C1
SYMATTR Value 2nF
SYMBOL OpAmps\\AD824 3664 -64 R0
SYMATTR InstName U1
SYMBOL OpAmps\\AD824 1856 80 M180
SYMATTR InstName U3
SYMBOL cap 2608 272 R0
SYMATTR InstName C3
SYMATTR Value 500nF
SYMATTR SpiceLine2 IC=3
SYMBOL cap 720 112 R0
SYMATTR InstName C4
SYMATTR Value 100µf
SYMATTR SpiceLine2 IC=12
SYMBOL bv 1152 48 R0
WINDOW 3 252 97 Right 2
SYMATTR Value V=2.5+0.083*I(R1)
SYMATTR InstName B1
SYMBOL voltage 48 176 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V4
SYMATTR Value SINE(20 3 150)
SYMBOL res 2720 240 R0
SYMATTR InstName R5
SYMATTR Value 30k
SYMBOL pnp 2416 64 M180
SYMATTR InstName Q2
SYMATTR Value BC557B
SYMBOL res 2368 -528 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 0 56 VBottom 2
SYMATTR InstName R3
SYMATTR Value 3.3k
SYMBOL schottky 2416 -496 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName D3
SYMATTR Value RB876W
SYMATTR Description Zener Diode
SYMATTR Type zener
SYMBOL res 2240 -528 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 0 56 VBottom 2
SYMATTR InstName R6
SYMATTR Value 2.2k
SYMBOL cap 2320 -368 R270
WINDOW 0 32 32 VTop 2
WINDOW 3 0 32 VBottom 2
SYMATTR InstName C2
SYMATTR Value 100nF
SYMBOL res 2128 -464 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 0 56 VBottom 2
SYMATTR InstName R7
SYMATTR Value 3.3k
SYMBOL res 2720 80 R0
SYMATTR InstName R9
SYMATTR Value 70k
SYMBOL OpAmps\\AD824 1856 336 M180
SYMATTR InstName U2
SYMBOL res 1856 -528 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 0 56 VBottom 2
SYMATTR InstName R10
SYMATTR Value 2.55k
SYMBOL schottky 1904 -496 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName D5
SYMATTR Value RB876W
SYMATTR Description Zener Diode
SYMATTR Type zener
SYMBOL res 1728 -528 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 0 56 VBottom 2
SYMATTR InstName R11
SYMATTR Value 2.45k
SYMBOL cap 1808 -368 R270
WINDOW 0 32 32 VTop 2
WINDOW 3 0 32 VBottom 2
SYMATTR InstName C5
SYMATTR Value 100nF
SYMBOL res 1616 -464 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 0 56 VBottom 2
SYMATTR InstName R12
SYMATTR Value 5k
SYMBOL npn 2096 224 R0
SYMATTR InstName Q1
SYMATTR Value BC547C
SYMBOL res 2080 256 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R13
SYMATTR Value 5k
SYMBOL npn 2416 400 R0
SYMATTR InstName Q3
SYMATTR Value BC547C
SYMBOL OpAmps\\AD824 1856 512 M180
SYMATTR InstName U4
SYMBOL res 2416 432 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R15
SYMATTR Value 100k
SYMBOL res 2416 0 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R16
SYMATTR Value 100k
SYMBOL res 2272 80 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R17
SYMATTR Value 25k
SYMBOL res 2464 240 R0
SYMATTR InstName R8
SYMATTR Value 6.6k
SYMBOL res 2464 80 R0
SYMATTR InstName R14
SYMATTR Value 6.6k
TEXT 3192 192 Left 2 ;75kHz square wave
TEXT 1120 -48 Left 2 ;ACS712 MODEL
TEXT 1200 16 Left 1 ;You may add low pass filter since\n this sensor has a bandwith of 50kHz
TEXT 14 776 Left 2 !.tran 0 25ms 1ms
TEXT 2328 -320 Left 2 ;CURRENT REFERENCE
TEXT 1672 -320 Left 2 ;MIN CURRENT REFERENCE (2.5A)
