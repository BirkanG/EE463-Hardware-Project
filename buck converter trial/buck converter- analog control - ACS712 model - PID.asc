Version 4
SHEET 1 4720 1324
WIRE 3696 -944 2624 -944
WIRE 3248 -816 3248 -864
WIRE 2880 -768 2832 -768
WIRE 3008 -768 2960 -768
WIRE 3248 -704 3248 -736
WIRE 3376 -704 3248 -704
WIRE 3472 -704 3376 -704
WIRE 3376 -688 3376 -704
WIRE 3248 -656 3248 -704
WIRE 2880 -640 2880 -656
WIRE 1872 -624 1856 -624
WIRE 2384 -624 2352 -624
WIRE 2736 -624 2720 -624
WIRE 2832 -624 2832 -768
WIRE 2832 -624 2800 -624
WIRE 2848 -624 2832 -624
WIRE 2064 -608 1584 -608
WIRE 2576 -608 2096 -608
WIRE 3008 -608 3008 -768
WIRE 3008 -608 2912 -608
WIRE 3024 -608 3008 -608
WIRE 3104 -608 3088 -608
WIRE 3184 -608 3104 -608
WIRE 3376 -608 3376 -624
WIRE 2720 -592 2720 -624
WIRE 2848 -592 2832 -592
WIRE 3104 -576 3104 -608
WIRE 2880 -560 2880 -576
WIRE 1744 -544 1712 -544
WIRE 1856 -544 1856 -624
WIRE 1856 -544 1824 -544
WIRE 1872 -544 1856 -544
WIRE 1984 -544 1952 -544
WIRE 2256 -544 2224 -544
WIRE 2352 -544 2352 -624
WIRE 2352 -544 2336 -544
WIRE 2384 -544 2352 -544
WIRE 2496 -544 2464 -544
WIRE 1472 -528 1472 -544
WIRE 3248 -496 3248 -560
WIRE 1712 -480 1712 -544
WIRE 1840 -480 1712 -480
WIRE 1984 -480 1984 -544
WIRE 1984 -480 1904 -480
WIRE 2032 -480 1984 -480
WIRE 2224 -480 2224 -544
WIRE 2352 -480 2224 -480
WIRE 2496 -480 2496 -544
WIRE 2496 -480 2416 -480
WIRE 2544 -480 2496 -480
WIRE 2832 -480 2832 -592
WIRE 2832 -480 2816 -480
WIRE 2896 -480 2832 -480
WIRE 3008 -480 3008 -608
WIRE 3008 -480 2976 -480
WIRE 2832 -448 2832 -480
WIRE 1472 -416 1472 -448
WIRE 1632 -384 1632 -480
WIRE 1712 -384 1712 -480
WIRE 1808 -384 1712 -384
WIRE 1984 -384 1984 -480
WIRE 1984 -384 1872 -384
WIRE 2144 -384 2144 -480
WIRE 2224 -384 2224 -480
WIRE 2320 -384 2224 -384
WIRE 2496 -384 2496 -480
WIRE 2496 -384 2384 -384
WIRE 2832 -352 2832 -368
WIRE 1584 -304 1584 -608
WIRE 2064 -304 2064 -608
WIRE 2064 -304 1584 -304
WIRE 2096 -304 2096 -608
WIRE 2576 -304 2576 -608
WIRE 2576 -304 2096 -304
WIRE 2624 -304 2624 -944
WIRE 3696 -304 3696 -944
WIRE 3696 -304 2624 -304
WIRE 2128 -176 2080 -176
WIRE 2240 -176 2208 -176
WIRE 368 -80 48 -80
WIRE 512 -80 368 -80
WIRE 608 -80 592 -80
WIRE 736 -80 688 -80
WIRE 928 -80 736 -80
WIRE 1488 -64 1104 -64
WIRE 2160 -48 2160 -64
WIRE 1632 -32 1616 -32
WIRE 1808 -32 1808 -64
WIRE 1888 -32 1808 -32
WIRE 2080 -32 2080 -176
WIRE 2080 -32 1968 -32
WIRE 2128 -32 2080 -32
WIRE 928 -16 928 -80
WIRE 2240 -16 2240 -176
WIRE 2240 -16 2192 -16
WIRE 2288 -16 2240 -16
WIRE 368 0 368 -80
WIRE 1616 0 1616 -32
WIRE 1616 0 1152 0
WIRE 1984 0 1616 0
WIRE 2096 0 2064 0
WIRE 2128 0 2096 0
WIRE 2160 32 2160 16
WIRE 2096 48 2096 0
WIRE 1152 64 1152 0
WIRE 736 112 736 -80
WIRE 2096 144 2096 128
WIRE 928 160 928 64
WIRE 1152 176 1152 144
WIRE 48 192 48 -80
WIRE 1104 224 1104 -64
WIRE 1488 224 1488 -64
WIRE 1488 224 1104 224
WIRE 368 352 368 64
WIRE 736 352 736 176
WIRE 736 352 368 352
WIRE 928 352 928 240
WIRE 928 352 736 352
WIRE 368 368 368 352
WIRE 320 448 304 448
WIRE 48 496 48 272
WIRE 48 496 16 496
WIRE 368 496 368 464
WIRE 368 496 48 496
WIRE 48 608 48 496
FLAG 1472 -416 0
FLAG 1472 -544 10V
FLAG 48 608 0
FLAG 304 448 pwm_signal
FLAG 1152 176 0
FLAG 1616 -32 ACS712_VOUT
FLAG 2144 -384 10V
FLAG 2544 -480 0
FLAG 2352 -624 CURRENT_REF
FLAG 1632 -384 10V
FLAG 2032 -480 0
FLAG 1856 -624 MIN_CURRENT_REF
FLAG 3376 -608 0
FLAG 3248 -496 0
FLAG 2880 -560 0
FLAG 2880 -656 10V
FLAG 2720 -592 0
FLAG 2736 -480 10V
FLAG 2832 -352 0
FLAG 3248 -864 10V
FLAG 3104 -496 0
FLAG 3472 -704 SAW_TOOTH
FLAG 2160 32 0
FLAG 2160 -64 10V
FLAG 1808 -144 0
FLAG 2096 144 0
SYMBOL nmos 320 368 R0
SYMATTR InstName M1
SYMATTR Value IRFZ46N
SYMBOL diode 384 64 R180
WINDOW 0 24 64 Left 2
WINDOW 3 24 0 Left 2
SYMATTR InstName D1
SYMBOL ind 496 -64 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 5 56 VBottom 2
SYMATTR InstName L1
SYMATTR Value 10µH
SYMBOL voltage 928 144 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V3
SYMATTR Value 12
SYMBOL res 912 -32 R0
SYMATTR InstName R1
SYMATTR Value 0.1
SYMBOL res 704 -96 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R4
SYMATTR Value 0.1
SYMBOL voltage 1472 -544 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V13
SYMATTR Value 10V
SYMBOL cap 720 112 R0
SYMATTR InstName C4
SYMATTR Value 100µf
SYMATTR SpiceLine2 IC=12
SYMBOL bv 1152 48 R0
WINDOW 3 252 97 Right 2
SYMATTR Value V=2.5+0.083*I(R1)
SYMATTR InstName B1
SYMBOL voltage 48 176 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V4
SYMATTR Value 18V
SYMBOL res 2368 -528 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 0 56 VBottom 2
SYMATTR InstName R3
SYMATTR Value 3.3k
SYMBOL schottky 2416 -496 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName D3
SYMATTR Value RB876W
SYMATTR Description Zener Diode
SYMATTR Type zener
SYMBOL res 2240 -528 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 0 56 VBottom 2
SYMATTR InstName R6
SYMATTR Value 2.2k
SYMBOL cap 2320 -368 R270
WINDOW 0 32 32 VTop 2
WINDOW 3 0 32 VBottom 2
SYMATTR InstName C2
SYMATTR Value 100nF
SYMBOL res 2128 -464 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 0 56 VBottom 2
SYMATTR InstName R7
SYMATTR Value 3.3k
SYMBOL res 1856 -528 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 0 56 VBottom 2
SYMATTR InstName R10
SYMATTR Value 2.55k
SYMBOL schottky 1904 -496 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName D5
SYMATTR Value RB876W
SYMATTR Description Zener Diode
SYMATTR Type zener
SYMBOL res 1728 -528 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 0 56 VBottom 2
SYMATTR InstName R11
SYMATTR Value 2.45k
SYMBOL cap 1808 -368 R270
WINDOW 0 32 32 VTop 2
WINDOW 3 0 32 VBottom 2
SYMATTR InstName C5
SYMATTR Value 100nF
SYMBOL res 1616 -464 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 0 56 VBottom 2
SYMATTR InstName R12
SYMATTR Value 5k
SYMBOL npn 3184 -656 R0
SYMATTR InstName Q1
SYMATTR Value BC546B
SYMBOL OpAmps\\AD824 2880 -672 R0
SYMATTR InstName U2
SYMBOL cap 2800 -640 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName C3
SYMATTR Value 1nF
SYMBOL res 2976 -784 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R8
SYMATTR Value 4k
SYMBOL res 2832 -496 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R9
SYMATTR Value 5k
SYMBOL res 2992 -496 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R13
SYMATTR Value 5k
SYMBOL res 2816 -464 R0
SYMATTR InstName R14
SYMATTR Value 5k
SYMBOL res 3232 -832 R0
SYMATTR InstName R2
SYMATTR Value 5k
SYMBOL cap 3088 -624 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName C6
SYMATTR Value 500pF
SYMBOL res 3088 -592 R0
SYMATTR InstName R5
SYMATTR Value 1k
SYMBOL cap 3360 -688 R0
SYMATTR InstName C1
SYMATTR Value 2nF
SYMBOL OpAmps\\AD824 2160 -80 R0
SYMATTR InstName U3
SYMBOL res 2224 -192 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R15
SYMATTR Value 60k
SYMBOL res 1984 -48 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R16
SYMATTR Value 1k
SYMBOL res 2080 -16 R90
WINDOW 0 -1 54 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R17
SYMATTR Value 1k
SYMBOL voltage 1808 -48 R180
WINDOW 0 24 96 Left 2
WINDOW 3 24 16 Left 2
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V1
SYMATTR Value 2.5V
SYMBOL res 2080 32 R0
SYMATTR InstName R18
SYMATTR Value 60k
TEXT 1120 -48 Left 2 ;ACS712 MODEL
TEXT 1200 16 Left 1 ;You may add low pass filter since\n this sensor has a bandwith of 50kHz
TEXT 16 776 Left 2 !.tran 0 5msms 1ms
TEXT 2328 -320 Left 2 ;CURRENT REFERENCE
TEXT 1672 -320 Left 2 ;MIN CURRENT REFERENCE (2.5A)
TEXT 2632 -920 Left 2 ;75KHZ SAWTOOTH GENERATOR
TEXT 3104 -680 Right 2 ;SQUARE WAVE
TEXT 1856 0 Left 2 ;V2
TEXT 1856 -32 Left 2 ;V1
