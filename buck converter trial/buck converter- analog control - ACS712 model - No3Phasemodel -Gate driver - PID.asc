Version 4
SHEET 1 6164 1748
WIRE 2464 -560 2432 -560
WIRE 2592 -560 2544 -560
WIRE 2832 -544 2800 -544
WIRE 2992 -544 2912 -544
WIRE 2496 -448 2496 -464
WIRE 2336 -432 2272 -432
WIRE 2432 -432 2432 -560
WIRE 2432 -432 2400 -432
WIRE 2464 -432 2432 -432
WIRE 2864 -432 2864 -448
WIRE 2592 -416 2592 -560
WIRE 2592 -416 2528 -416
WIRE 2672 -416 2672 -496
WIRE 2672 -416 2592 -416
WIRE 2704 -416 2672 -416
WIRE 2800 -416 2800 -544
WIRE 2800 -416 2784 -416
WIRE 2832 -416 2800 -416
WIRE 2464 -400 2432 -400
WIRE 2992 -400 2992 -544
WIRE 2992 -400 2896 -400
WIRE 3040 -400 3040 -496
WIRE 3040 -400 2992 -400
WIRE 2832 -384 2800 -384
WIRE 2496 -368 2496 -384
WIRE 2432 -352 2432 -400
WIRE 2864 -352 2864 -368
WIRE 2800 -336 2800 -384
WIRE 3520 -336 3504 -336
WIRE 3520 -224 3520 -336
WIRE 3520 -224 3504 -224
WIRE 3552 -224 3520 -224
WIRE 3680 -224 3632 -224
WIRE 3840 -208 3808 -208
WIRE 4000 -208 3920 -208
WIRE 1952 -144 1920 -144
WIRE 2080 -144 2032 -144
WIRE 1552 -128 1488 -128
WIRE 2416 -112 2384 -112
WIRE 2544 -112 2480 -112
WIRE 3584 -112 3584 -128
WIRE 2832 -96 2800 -96
WIRE 2992 -96 2912 -96
WIRE 3520 -96 3520 -224
WIRE 3520 -96 3504 -96
WIRE 3552 -96 3520 -96
WIRE 3872 -96 3872 -112
WIRE 368 -80 64 -80
WIRE 512 -80 368 -80
WIRE 608 -80 592 -80
WIRE 736 -80 688 -80
WIRE 928 -80 736 -80
WIRE 3680 -80 3680 -224
WIRE 3680 -80 3616 -80
WIRE 3712 -80 3680 -80
WIRE 3808 -80 3808 -208
WIRE 3808 -80 3792 -80
WIRE 3840 -80 3808 -80
WIRE 1488 -64 1104 -64
WIRE 3552 -64 3520 -64
WIRE 4000 -64 4000 -208
WIRE 4000 -64 3904 -64
WIRE 4064 -64 4000 -64
WIRE 3840 -48 3808 -48
WIRE 3584 -32 3584 -48
WIRE 928 -16 928 -80
WIRE 1984 -16 1984 -32
WIRE 3872 -16 3872 -32
WIRE 368 0 368 -80
WIRE 1552 0 1552 -128
WIRE 1552 0 1152 0
WIRE 1760 0 1552 0
WIRE 1920 0 1920 -144
WIRE 1920 0 1840 0
WIRE 1952 0 1920 0
WIRE 2448 0 2448 -16
WIRE 3808 0 3808 -48
WIRE 2080 16 2080 -144
WIRE 2080 16 2016 16
WIRE 2144 16 2144 -32
WIRE 2144 16 2080 16
WIRE 2272 16 2272 -432
WIRE 2272 16 2144 16
WIRE 2384 16 2384 -112
WIRE 2384 16 2352 16
WIRE 2416 16 2384 16
WIRE 2864 16 2864 0
WIRE 1952 32 1920 32
WIRE 2544 32 2544 -112
WIRE 2544 32 2480 32
WIRE 2624 32 2624 -48
WIRE 2624 32 2544 32
WIRE 2704 32 2624 32
WIRE 2800 32 2800 -96
WIRE 2800 32 2784 32
WIRE 2832 32 2800 32
WIRE 3520 32 3520 -64
WIRE 2416 48 2384 48
WIRE 2992 48 2992 -96
WIRE 2992 48 2896 48
WIRE 3040 48 3040 -48
WIRE 3040 48 2992 48
WIRE 1152 64 1152 0
WIRE 2832 64 2800 64
WIRE 1984 80 1984 48
WIRE 2448 80 2448 64
WIRE 2384 96 2384 48
WIRE 2864 96 2864 80
WIRE 736 112 736 -80
WIRE 1760 112 1680 112
WIRE 1920 112 1920 32
WIRE 1920 112 1840 112
WIRE 2800 112 2800 64
WIRE 1680 128 1680 112
WIRE 928 160 928 64
WIRE 1920 160 1920 112
WIRE 1152 176 1152 144
WIRE 64 192 64 -80
WIRE 1104 224 1104 -64
WIRE 1488 224 1488 -64
WIRE 1488 224 1104 224
WIRE 1680 256 1680 208
WIRE 1920 272 1920 240
WIRE 368 352 368 64
WIRE 736 352 736 176
WIRE 736 352 368 352
WIRE 928 352 928 240
WIRE 928 352 736 352
WIRE 368 368 368 352
WIRE 320 448 288 448
WIRE 64 496 64 272
WIRE 368 496 368 464
WIRE 368 496 64 496
WIRE 2384 576 2384 560
WIRE 64 608 64 496
WIRE 3024 608 3024 592
WIRE 1920 624 1888 624
WIRE 2080 624 2000 624
WIRE 2992 624 2896 624
WIRE 3168 640 3056 640
WIRE 3296 640 3168 640
WIRE 2480 656 2384 656
WIRE 2752 656 2480 656
WIRE 2992 656 2752 656
WIRE 2384 672 2384 656
WIRE 2480 672 2480 656
WIRE 2752 688 2752 656
WIRE 2752 688 2736 688
WIRE 3024 688 3024 672
WIRE 3168 736 3168 720
WIRE 3296 736 3280 736
WIRE 3568 736 3520 736
WIRE 3648 736 3568 736
WIRE 1952 752 1952 736
WIRE 1760 768 1744 768
WIRE 1888 768 1888 624
WIRE 1888 768 1824 768
WIRE 1920 768 1888 768
WIRE 2080 784 2080 624
WIRE 2080 784 1984 784
WIRE 2160 784 2160 752
WIRE 2160 784 2080 784
WIRE 2224 784 2160 784
WIRE 2320 784 2304 784
WIRE 1920 800 1888 800
WIRE 2480 816 2480 736
WIRE 1952 832 1952 816
WIRE 3744 832 3520 832
WIRE 2384 880 2384 832
WIRE 1792 896 1776 896
WIRE 1888 896 1888 800
WIRE 1888 896 1872 896
WIRE 1904 896 1888 896
WIRE 2080 896 2080 784
WIRE 2080 896 1984 896
WIRE 672 912 672 896
WIRE 800 912 800 896
WIRE 912 912 912 896
WIRE 3568 928 3568 800
WIRE 3568 928 3520 928
WIRE 1888 960 1888 896
WIRE 672 1024 672 992
WIRE 800 1024 800 992
WIRE 912 1024 912 992
WIRE 1888 1056 1888 1040
FLAG 912 1024 0
FLAG 912 896 5V
FLAG 64 608 0
FLAG 1152 176 0
FLAG 1488 -128 ACS712_VOUT
FLAG 800 1024 0
FLAG 800 896 10V
FLAG 1984 -32 10V
FLAG 1680 256 0
FLAG 1952 832 0
FLAG 1952 736 10V
FLAG 1776 896 10V
FLAG 1888 1056 0
FLAG 1744 768 0
FLAG 2480 816 0
FLAG 2384 880 0
FLAG 2752 688 TRIANGLE_75kHz
FLAG 2160 752 SQUARE_75kHz
FLAG 2384 560 10V
FLAG 3024 688 0
FLAG 3024 592 10V
FLAG 3168 736 0
FLAG 3280 736 10V
FLAG 3648 736 10V
FLAG 3744 832 PWM_SIGNAL
FLAG 288 448 PWM_SIGNAL
FLAG 2144 -32 ERROR_PROPORTIONAL
FLAG 2448 -16 10V
FLAG 672 1024 0
FLAG 672 896 -10V
FLAG 2448 80 -10V
FLAG 1984 80 -10V
FLAG 2384 96 0
FLAG 2624 -48 ~ERROR_INTEGRAL
FLAG 2864 0 10V
FLAG 2864 96 -10V
FLAG 2800 112 0
FLAG 3584 -128 10V
FLAG 3584 -32 -10V
FLAG 3040 -48 ERROR_INTEGRAL
FLAG 3424 -224 ERROR_INTEGRAL
FLAG 3424 -96 ERROR_PROPORTIONAL
FLAG 3520 32 0
FLAG 3872 -112 10V
FLAG 3872 -16 -10V
FLAG 3808 0 0
FLAG 4064 -64 PWM_REFERENCE
FLAG 2896 624 PWM_REFERENCE
FLAG 2496 -464 10V
FLAG 2496 -368 -10V
FLAG 2432 -352 0
FLAG 2672 -496 ~ERROR_DERIVATIVE
FLAG 2864 -448 10V
FLAG 2864 -352 -10V
FLAG 2800 -336 0
FLAG 3040 -496 ERROR_DERIVATIVE
FLAG 1920 272 0
FLAG 3424 -336 ERROR_DERIVATIVE
SYMBOL nmos 320 368 R0
SYMATTR InstName M1
SYMATTR Value IRFZ46N
SYMBOL diode 384 64 R180
WINDOW 0 24 64 Left 2
WINDOW 3 24 0 Left 2
SYMATTR InstName D1
SYMBOL ind 496 -64 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 5 56 VBottom 2
SYMATTR InstName L1
SYMATTR Value 10µH
SYMBOL voltage 928 144 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V3
SYMATTR Value 12
SYMBOL res 912 -32 R0
SYMATTR InstName R1
SYMATTR Value 0.05
SYMBOL res 704 -96 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R4
SYMATTR Value 0.1
SYMBOL voltage 912 896 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V13
SYMATTR Value 5V
SYMBOL cap 720 112 R0
SYMATTR InstName C4
SYMATTR Value 2200µF
SYMATTR SpiceLine2 IC=12
SYMBOL bv 1152 48 R0
WINDOW 3 252 97 Right 2
SYMATTR Value V=2.5+0.083*I(R1)
SYMATTR InstName B1
SYMBOL voltage 64 176 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V4
SYMATTR Value SINE(30 8 150)
SYMBOL voltage 800 896 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V2
SYMATTR Value 10V
SYMBOL OpAmps\\AD824 1984 -48 R0
SYMATTR InstName U2
SYMBOL res 2048 -160 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R5
SYMATTR Value 10k
SYMBOL res 1856 -16 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R8
SYMATTR Value 1k
SYMBOL res 1856 96 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R9
SYMATTR Value 1k
SYMBOL res 1936 256 R180
WINDOW 0 36 76 Left 2
WINDOW 3 36 40 Left 2
SYMATTR InstName R13
SYMATTR Value 10k
SYMBOL voltage 1680 112 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V5
SYMATTR Value 3.33V
SYMBOL OpAmps\\AD824 1952 720 R0
SYMATTR InstName U1
SYMBOL res 1888 880 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R3
SYMATTR Value 5k
SYMBOL res 2000 880 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R6
SYMATTR Value 5k
SYMBOL res 1904 1056 R180
WINDOW 0 36 76 Left 2
WINDOW 3 36 40 Left 2
SYMATTR InstName R7
SYMATTR Value 5k
SYMBOL res 2016 608 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R10
SYMATTR Value 4k
SYMBOL cap 1824 752 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName C1
SYMATTR Value 1nF
SYMBOL npn 2320 736 R0
SYMATTR InstName Q1
SYMATTR Value BC546B
SYMBOL res 2320 768 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R12
SYMATTR Value 200k
SYMBOL cap 2464 672 R0
SYMATTR InstName C2
SYMATTR Value 3nF
SYMATTR SpiceLine2 IC=0
SYMBOL res 2368 560 R0
SYMATTR InstName R11
SYMATTR Value 1k
SYMBOL OpAmps\\AD824 3024 576 R0
SYMATTR InstName U3
SYMBOL res 3152 624 R0
SYMATTR InstName R14
SYMATTR Value 10k
SYMBOL ir2184 3408 688 R0
SYMATTR InstName X1
SYMBOL cap 3552 736 R0
SYMATTR InstName C3
SYMATTR Value 100nF
SYMBOL OpAmps\\AD824 2448 -32 R0
SYMATTR InstName U4
SYMBOL cap 2480 -128 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName C5
SYMATTR Value 25nF
SYMATTR SpiceLine2 IC=0
SYMBOL res 2368 0 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R15
SYMATTR Value 25k
SYMBOL voltage 672 896 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V1
SYMATTR Value -10V
SYMBOL diode 2368 672 R0
SYMATTR InstName D2
SYMBOL OpAmps\\AD824 2864 -16 R0
SYMATTR InstName U5
SYMBOL res 2928 -112 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R2
SYMATTR Value 10k
SYMBOL res 2800 16 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R16
SYMATTR Value 10k
SYMBOL OpAmps\\AD824 3584 -144 R0
SYMATTR InstName U6
SYMBOL res 3520 -112 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R17
SYMATTR Value 10k
SYMBOL res 3520 -240 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R18
SYMATTR Value 10k
SYMBOL res 3648 -240 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R19
SYMATTR Value 10k
SYMBOL OpAmps\\AD824 3872 -128 R0
SYMATTR InstName U7
SYMBOL res 3936 -224 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R20
SYMATTR Value 10k
SYMBOL res 3808 -96 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R21
SYMATTR Value 10k
SYMBOL OpAmps\\AD824 2496 -480 R0
SYMATTR InstName U8
SYMBOL cap 2400 -448 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName C6
SYMATTR Value 25nF
SYMATTR SpiceLine2 IC=0
SYMBOL res 2560 -576 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R23
SYMATTR Value 1k
SYMBOL OpAmps\\AD824 2864 -464 R0
SYMATTR InstName U9
SYMBOL res 2928 -560 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R24
SYMATTR Value 5k
SYMBOL res 2800 -432 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R25
SYMATTR Value 10k
SYMBOL res 3520 -352 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R26
SYMATTR Value 10k
TEXT 1120 -48 Left 2 ;ACS712 MODEL
TEXT 1200 16 Left 1 ;You may add low pass filter since\n this sensor has a bandwith of 50kHz
TEXT 238 632 Left 2 !.tran 0 10ms 0ms
